# 동의어 사전 기반 검색 시스템

## 📋 개요

한방식권 Q&A 문서에서 **동의어 사전 기반 쿼리 확장**을 통해 검색 정확도를 높인 검색 시스템입니다.

### 주요 특징

- ✅ **동의어 사전 기반 쿼리 확장**: "QR코드" = "큐알코드" = "QR" 자동 매핑
- ✅ **공백 처리**: "정산업무" = "정산 업무" 자동 인식
- ✅ **관련도 점수**: 검색 결과를 점수 기준으로 정렬
- ✅ **확장 가능한 사전**: JSON 파일로 쉽게 동의어 추가 가능

---

## 🗂️ 파일 구조

```
fastapi/
├── data/
│   ├── hanbang_qa.md          # Q&A 문서
│   └── synonyms.json          # 동의어 사전
├── search_utils.py             # 검색 유틸리티 함수
├── google_calendar_webhook.py # FastAPI 서버 (검색 엔드포인트 포함)
├── test_search.py              # 기본 테스트 (모든 기능)
└── test_search_standalone.py  # 독립 실행 테스트 (검색만)
```

---

## 🚀 사용 방법

### 1. 동의어 사전 확인

[data/synonyms.json](data/synonyms.json) 파일에서 동의어 매핑을 확인할 수 있습니다.

```json
{
  "QR코드": ["큐알코드", "QR", "qr코드", "qr", "큐알"],
  "정산": ["정산업무", "정산 업무"],
  "식권": ["쿠폰", "식사권"]
}
```

### 2. 검색 테스트 실행

```bash
cd 19th_KatokBot_For_Student/fastapi
python test_search_standalone.py
```

**테스트 결과 예시:**

```
============================================================
쿼리: '정산업무'
============================================================
🔍 '정산업무' 검색 결과 (확장: 작업, 업무, 정산 업무...):

• | **Q1. 시스템 도입으로 정산 업무가 얼마나 줄어드나요?** | ...
• 식당은 **QR 코드 일괄 인식** 기능을 통해 정산 업무를 간편하게 처리할 수 있습니다.
```

### 3. FastAPI 서버에서 검색 사용

#### 서버 실행

```bash
uvicorn google_calendar_webhook:app --host 0.0.0.0 --port 9000 --reload
```

#### API 호출

```bash
curl -X POST http://localhost:9000/search \
  -H "Content-Type: application/json" \
  -d '{"room": "test", "sender": "user", "message": "QR코드"}'
```

**응답 예시:**

```json
"🔍 'QR코드' 검색 결과 (확장: 큐알코드, qr, qr코드...):\n\n• |**Q1. 시스템 사용 시 직원이 해야 할 일은 무엇인가요?**|식권을 사용하는 **직원 입장에서는 이제 아무것도 할 필요가 없습니다**. 정산관리자가 지급한 **QR코드 식권만 사용**하시면 됩니다 [3, 11c].|[3, 11c]|\n..."
```

---

## 🔧 동의어 사전 관리

### 동의어 추가 방법

[data/synonyms.json](data/synonyms.json) 파일을 수정하여 동의어를 추가할 수 있습니다.

**예시:**

```json
{
  "새로운_키워드": ["동의어1", "동의어2", "동의어3"]
}
```

### 동의어 사전 설계 가이드

1. **키 선택**: 가장 대표적인 표현을 키로 사용
2. **동의어 추가**: 사용자가 입력할 가능성이 있는 모든 변형 추가
3. **공백 처리**: 공백이 있는 버전과 없는 버전 모두 추가 권장

**좋은 예시:**

```json
{
  "QR코드": ["큐알코드", "QR", "qr코드", "qr", "큐알"],
  "정산": ["정산업무", "정산 업무"]
}
```

---

## 📊 검색 알고리즘

### 1. 쿼리 확장 (Query Expansion)

입력된 쿼리를 동의어 사전을 사용하여 확장합니다.

**예시:**

- 입력: `"큐알코드"`
- 확장: `["큐알코드", "qr코드", "qr", "QR코드", "큐알"]`

### 2. 텍스트 매칭 (Text Matching)

확장된 쿼리 중 하나라도 텍스트에 포함되면 매칭됩니다.

### 3. 관련도 점수 (Relevance Score)

- **원본 쿼리 매칭**: +1.0점
- **동의어 매칭**: +0.5 + (매칭 개수 × 0.1)점

### 4. 결과 정렬 및 반환

- 점수가 높은 순으로 정렬
- 상위 5개 결과만 반환

---

## 🧪 테스트 결과

### 테스트 케이스

| 쿼리 | 확장 쿼리 | 결과 |
|------|-----------|------|
| `정산업무` | `작업`, `업무`, `정산 업무`, `정산`, ... | ✅ 5건 |
| `QR코드` | `큐알코드`, `qr`, `qr코드`, `QR`, ... | ✅ 5건 |
| `큐알코드` | `큐알코드`, `qr`, `qr코드`, `QR`, ... | ✅ 5건 |
| `회원가입` | `등록하기`, `회원가입`, `가입`, `등록`, ... | ✅ 5건 |
| `제로페이` | `제로페이`, `zeropay`, `0페이` | ✅ 5건 |
| `식당 정산` | `식당정산`, `식당`, `음식점`, `정산`, ... | ✅ 5건 |

---

## 📈 성능 개선 포인트

### 현재 구현 (옵션 1: 동의어 사전)

- ✅ **구현 시간**: 1시간 이내
- ✅ **정확도**: 높음 (한글 특화)
- ✅ **유지보수**: 쉬움 (JSON 파일 수정)

### 향후 개선 가능 (옵션 3: 하이브리드)

- 🔄 **SequenceMatcher 추가**: 동의어 사전에 없는 단어 대응
- 🔄 **형태소 분석**: 한글 어근 분석 (예: "정산하다" → "정산")
- 🔄 **TF-IDF**: 문서 중요도 반영

---

## 💡 사용 팁

### 1. 검색이 잘 안될 때

- 동의어 사전에 해당 키워드를 추가하세요
- 공백을 제거하거나 추가해보세요 (예: "정산업무" → "정산 업무")

### 2. 검색 결과가 너무 많을 때

- 더 구체적인 키워드를 사용하세요 (예: "정산" → "식당 정산")

### 3. 동의어 사전 관리

- 주기적으로 검색 로그를 확인하여 누락된 동의어를 추가하세요
- 사용 빈도가 높은 동의어를 우선적으로 추가하세요

---

## 🔗 관련 파일

- [search_utils.py](search_utils.py) - 검색 유틸리티 함수
- [data/synonyms.json](data/synonyms.json) - 동의어 사전
- [google_calendar_webhook.py](google_calendar_webhook.py) - FastAPI 서버
- [test_search_standalone.py](test_search_standalone.py) - 독립 실행 테스트

---

## 📞 문의

검색 기능 개선 제안이나 버그 리포트는 이슈로 등록해주세요.

---

**생성일**: 2025-12-02
**버전**: 1.0.0
